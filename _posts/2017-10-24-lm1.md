---
layout: post
title:  "Linear Modeling I"
date:   2017-10-24
permalink: /day9_lm1
---


## Lecture 

+ [Slides](./slides/day9_lm1.pdf)
+ [In-class exercises]({{ site.baseurl }}{% link inclass/day9_exercises.md %})
+ [**Linear modeling supplement**]({{ site.baseurl }}{% link files/lm_supplement.pdf %})
	+ An *excellent* overview of linear modeling, including model intepretation and fitting in R, written by [Claus Wilke, PhD](http://wilkelab.org).

<br>
## R content

+ [Broom vignette](https://cran.r-project.org/web/packages/broom/vignettes/broom.html)
+ See Linear modeling supplement above as well


### ANOVA

<pre><code class="language-r">

## Using the following dataset:
> bone.data
#          group calcium
# 1       normal    1200
# 2       normal    1000
# 3       normal     980
# 4       normal     900
# 5       normal     750
# 6       normal     800
# 7   osteopenia    1000
# 8   osteopenia    1100
# 9   osteopenia     700
#10   osteopenia     800
#11   osteopenia     500
#12   osteopenia     700
#13 osteoporosis     490
#14 osteoporosis     650
#15 osteoporosis     200
#16 osteoporosis     300
#17 osteoporosis     400
#18 osteoporosis     350


### Run the ANOVA with aov()
> fitted <- aov(calcium ~ group, data = bone.data)

### View output with summary()
> summary(fitted)
            Df Sum Sq Mean Sq F value   Pr(>F)    
group        2 944144  472072   14.36 0.000328 ***
Residuals   15 493167   32878                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

### We can compute R^2 as SS_group / SS_total
> 944144/(944144 + 493167)
[1] 0.6568822


### If desired, run the post-doc Tukey test
> TukeyHSD(fitted)
  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = calcium ~ group, data = bone.data)

$group
                             diff       lwr       upr     p adj
osteopenia-normal       -138.3333 -410.2534  133.5867 0.4054988
osteoporosis-normal     -540.0000 -811.9200 -268.0800 0.0003238
osteoporosis-osteopenia -401.6667 -673.5867 -129.7466 0.0043335
</code></pre>

### Correlation

<pre><code class="language-r">

## Using iris, run correlation test between setosa sepal lengths and widths
> iris %>% filter(Species == "setosa") -> setosa

> cor.test(setosa$Sepal.Length, setosa$Sepal.Width)
	Pearson's product-moment correlation

data:  setosa$Sepal.Length and setosa$Sepal.Width
t = 7.6807, df = 48, p-value = 6.71e-10
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.5851391 0.8460314
sample estimates:
      cor 
0.7425467 


### Run a Spearman's rank correlation
> cor.test(setosa$Sepal.Length, setosa$Sepal.Width, method = "spearman")

	Spearman's rank correlation rho

data:  setosa$Sepal.Length and setosa$Sepal.Width
S = 5095.1, p-value = 2.317e-10
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.7553375 
</code></pre>

### Regression

<pre><code class="language-r">
## Using iris, model the relationship between setosa sepal lengths and widths
> iris %>% filter(Species == "setosa") -> setosa

### Fit the model
> model <- lm(Sepal.Length ~ Sepal.Width, data = setosa)

### View model
> summary(model)
Call:
lm(formula = Sepal.Length ~ Sepal.Width, data = setosa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.52476 -0.16286  0.02166  0.13833  0.44428 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)   2.6390     0.3100   8.513 3.74e-11 ***
Sepal.Width   0.6905     0.0899   7.681 6.71e-10 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.2385 on 48 degrees of freedom
Multiple R-squared:  0.5514,	Adjusted R-squared:  0.542 
F-statistic: 58.99 on 1 and 48 DF,  p-value: 6.71e-10

## View cleaned model with broom
> tidy(model)
         term  estimate  std.error statistic      p.value
1 (Intercept) 2.6390012 0.31001431  8.512514 3.742438e-11
2 Sepal.Width 0.6904897 0.08989888  7.680738 6.709843e-10

> glance(model)  
r.squared adj.r.squared     sigma statistic      p.value df   logLik      AIC
1 0.5513756     0.5420292 0.2385422  58.99373 6.709843e-10  2 1.734067 2.531865
       BIC deviance df.residual
1 8.267934 2.731315          48
</code></pre>



